"use strict";(self.webpackChunkvristo_angular=self.webpackChunkvristo_angular||[]).push([[629],{7629:(se,k,n)=>{n.r(k),n.d(k,{TablesViewModule:()=>z});var T=n(6895),F=n(3559),e=n(4650),E=n(4609),M=n(9872),L=n(798),B=n(1801),P=n(2477),Z=n(2924),$=n(2808),q=n(1258),J=n(3210),V=n(454),I=n(4463);function N(i,u){if(1&i&&(e.TgZ(0,"div",12),e._UZ(1,"div"),e.TgZ(2,"div",13),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&i){const t=u.$implicit;e.xp6(1),e.Gre("h-4 w-4 rounded-sm  ltr:mr-2 rtl:ml-2 ",t.color,""),e.xp6(2),e.Oqu(e.lcZ(4,4,t.label))}}const U=function(i,u){return{"btn-outline-primary":i,"btn-primary":u}};function Y(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"div",16)(1,"button",17),e.NdJ("click",function(){const l=e.CHM(t).$implicit,r=e.oxw(2);return e.KtG(r.selectFloor(l))}),e._uU(2),e.qZA()()}if(2&i){const t=u.$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.WLB(2,U,o.selectedFloor.id!=t.id,o.selectedFloor.id==t.id)),e.xp6(1),e.Oqu(t.name)}}function D(i,u){if(1&i&&(e.TgZ(0,"div",14),e.YNc(1,Y,3,5,"div",15),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.lstFloors)}}const S=function(i,u){return{"btn-primary":i,"btn-dark":u}},Q=function(i){return{"grid grid-cols-12":i}},_=function(i){return{"col-span-11":i}},H=[{path:"",component:(()=>{class i{constructor(t,o,s,l,r,a){this.gto=t,this.accountingService=o,this.invoiceHelperService=s,this.localHttpClient=l,this.common=r,this.managementService=a,this.lstLkpKeys=["lstTablesStatus"],this.lstLkps={},this.lstFloors=[],this.lstTables=[],this.tablesLoaded=!1,this.svgLoaded=!1,this.isMoveOrderEnabeld=!1,this.moveOrderModel={},this.gto.changeScreenTitle$.next({title:"TableScreen"}),this.managementService.GetCompanyInfo({}).subscribe(c=>{this.comapnySetup=c,this.common.fixImagesUrls(this.comapnySetup,["lockTableImg","selectTableImg"])}),this.subscribeToEvents()}subscribeToEvents(){this.closePosPaymentScreen=this.gto.closePosPaymentScreen$.subscribe(t=>this.handleClosePosPayment(t)),this.closePosOrdersList=this.gto.closePosOrdersList$.subscribe(t=>this.handleClosePosOrdersList(t))}ngOnDestroy(){this.closePosPaymentScreen&&this.closePosPaymentScreen.unsubscribe(),this.closePosOrdersList&&this.closePosOrdersList.unsubscribe()}ngOnInit(){this.common.loadLkps(this.lstLkpKeys,this.lstLkps,this.checkLkps.bind(this)),this.getFloorsData()}checkLkps(){this.lstLkps.lstTablesStatus&&this.fetchTablesStatuses()}getFloorsData(){this.accountingService.FloorsList({p:1,ps:25}).subscribe(t=>{this.lstFloors=t.lstData,this.common.fixImagesUrls(this.lstFloors,"img"),this.lstFloors[0]?this.selectFloor(this.lstFloors[0]):alert("No Floors Declared")})}getTables(t){let o={floorId:t};this.tablesLoaded=!1,this.accountingService.GetTablesStatuses(o).subscribe(s=>{this.tablesLoaded=!0,this.lstTables.forEach(l=>{let r=s.lstData.find(a=>a.id==l.id);r?r.p?l.status=1:r.b&&(l.status=2):l.status=0}),this.fetchTablesStatuses()})}selectFloor(t){this.selectedFloor=t,this.lstTables=t.lstTables,this.refreshFloorSVG(),this.getTables(this.selectedFloor.id),this.disableMoveOrder()}refreshFloorSVG(){this.selectedFloor&&(this.svgLoaded=!1,this.localHttpClient.getWithCustomOptions(this.selectedFloor.img,{responseType:"text"}).subscribe(t=>{var o=(new DOMParser).parseFromString(t,"application/xml").documentElement;let s=document.getElementById("svgBox");o.setAttribute("width","100%"),o.setAttribute("height","100%"),s.innerHTML="",s.appendChild(s.ownerDocument.importNode(o,!0)),this.svgLoaded=!0,this.addTablesClickEvents(),this.fetchTablesStatuses()},t=>{alert(`No svg declared for floor, ${this.selectedFloor.img}`),this.svgLoaded=!1}))}fetchTablesStatuses(){if(this.lstLkps.lstTablesStatus&&this.tablesLoaded&&this.svgLoaded){let o=document.getElementById("svgBox").querySelector("svg");this.lstTables.forEach(s=>{let l=this.lstLkps.lstTablesStatus.find(r=>r.value==s.status);this.highlightWidget(o,s.name,l.rgb,l.fColor)})}}addTablesClickEvents(){document.getElementById("svgBox").querySelector("svg").querySelectorAll("a").forEach(l=>{let r=l.getAttributeNS("http://www.w3.org/1999/xlink","href");l.addEventListener("click",a=>{a.preventDefault();let c=r?.split("/").pop();console.log("Clicked on table:",c),this.handleTableClick(c)})})}highlightWidget(t,o,s,l){let r=t.querySelectorAll("a"),a=Array.from(r).find(te=>te.getAttributeNS("http://www.w3.org/1999/xlink","href")===`https://app.diagrams.net/${o}`);if(!a)return void console.warn(`Code ${o} not found`);let c=a.querySelector("image");if(!c)return void console.warn(`No <image> found inside link for ${o}`);let m=parseFloat(c.getAttribute("x")||"0"),b=parseFloat(c.getAttribute("y")||"0"),p=parseFloat(c.getAttribute("width")||"100"),A=parseFloat(c.getAttribute("height")||"100"),f=a.closest("g");if(!f)return void console.warn(`No parent <g> found to append elements for ${o}`);let O=m+(p-100)/2,x=b+(A-40)/2,d=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");d.setAttribute("x",O.toString()),d.setAttribute("y",x.toString()),d.setAttribute("width",100..toString()),d.setAttribute("height",40..toString());let g=document.createElement("div");g.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),g.style.width="100%",g.style.height="100%",g.style.backgroundColor=s,g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.color=l,g.style.fontWeight="bold",g.style.borderRadius="6px",g.style.fontSize="15px",g.textContent=`Note: ${o}`,d.appendChild(g);let R=m+p-60+10,ee=b,v=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");v.setAttribute("x",R.toString()),v.setAttribute("y",ee.toString()),v.setAttribute("width",60..toString()),v.setAttribute("height",60..toString());let h=document.createElement("div");h.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),h.style.width="100%",h.style.height="100%",h.style.borderRadius="50%",h.style.backgroundColor=s,h.style.display="flex",h.style.alignItems="center",h.style.justifyContent="center",h.style.fontWeight="bold",h.style.fontSize="18px",h.style.color=l,h.style.boxShadow="0 0 4px rgba(0,0,0,0.3)",h.textContent=o,v.appendChild(h),f.appendChild(d),f.appendChild(v)}handleTableClick(t){let o=this.lstTables.find(s=>s.name==t);console.log(t,o),this.isMoveOrderEnabeld?(this.moveOrderModel||(this.moveOrderModel={}),this.moveOrderModel.fromTbl?t!=this.moveOrderModel.fromTbl&&(this.moveOrderModel.toTbl&&this.hasBadgeIcon(this.moveOrderModel.toTbl,"selectico")&&this.removeBadgeIconFromTable(this.moveOrderModel.toTbl,"selectico"),this.handleAddSelectIcon(t),this.moveOrderModel.toTbl=t,this.gto.openPosMoveOrderItems$.next({fromOrderId:1,toOrderId:2})):(this.handleAddSelectIcon(t),this.moveOrderModel.fromTbl=t)):this.common.navigateTo("../pos",{tId:o.id,t})}handleAddSelectIcon(t){this.hasBadgeIcon(t,"selectico")?this.removeBadgeIconFromTable(t,"selectico"):this.addBadgeIconToTable(t,"selectico","top-left")}addBadgeIconToTable(t,o,s,l=24){const r=document.getElementById("svgBox")?.querySelector("svg");if(!r)return;const a=document.getElementById(o);if(!a||!a.src)return void console.warn(`Icon with ID "${o}" not found or has no src`);const c=a.src,m=r.querySelectorAll("a"),b=Array.from(m).find(g=>g.getAttributeNS("http://www.w3.org/1999/xlink","href")===`https://app.diagrams.net/${t}`);if(!b)return void console.warn(`Code ${t} not found`);const p=b.querySelector("image");if(!p)return void console.warn(`No <image> inside <a> for ${t}`);const A=parseFloat(p.getAttribute("x")||"0"),f=parseFloat(p.getAttribute("y")||"0"),w=parseFloat(p.getAttribute("height")||"0"),y=b.closest("g");if(!y)return void console.warn(`No container <g> for ${t}`);let O=A+26,x="top-left"===s?f+6:f+w-l-6;const d=document.createElementNS("http://www.w3.org/2000/svg","image");d.setAttributeNS(null,"href",c),d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c),d.setAttribute("x",O.toString()),d.setAttribute("y",x.toString()),d.setAttribute("width",l.toString()),d.setAttribute("height",l.toString()),d.setAttribute("preserveAspectRatio","xMidYMid meet"),d.setAttribute("class",`badge-icon ${o}`),d.setAttribute("data-code",t),d.setAttribute("data-icon",o),y.appendChild(d)}hasBadgeIcon(t,o){const s=document.getElementById("svgBox")?.querySelector("svg");if(!s)return!1;const l=s.querySelectorAll("a"),r=Array.from(l).find(c=>c.getAttributeNS("http://www.w3.org/1999/xlink","href")===`https://app.diagrams.net/${t}`);if(!r)return!1;const a=r.closest("g");return!!a&&!!a.querySelector(`image.badge-icon.${o}`)}removeBadgeIconFromTable(t,o){const s=document.getElementById("svgBox")?.querySelector("svg");if(!s)return;const l=s.querySelectorAll("a"),r=Array.from(l).find(m=>m.getAttributeNS("http://www.w3.org/1999/xlink","href")===`https://app.diagrams.net/${t}`);if(!r)return;const a=r.closest("g");a&&a.querySelectorAll(`image.badge-icon.${o}`).forEach(m=>m.remove())}removeAllIconsFromTable(t){const o=document.getElementById("svgBox")?.querySelector("svg");if(!o)return;const s=o.querySelectorAll("a"),l=Array.from(s).find(c=>c.getAttributeNS("http://www.w3.org/1999/xlink","href")===`https://app.diagrams.net/${t}`);if(!l)return;const r=l.closest("g");r&&r.querySelectorAll("image.badge-icon").forEach(c=>c.remove())}clearAllBadgeIcons(t){const o=document.getElementById("svgBox")?.querySelector("svg");o&&o.querySelectorAll(t?`image.badge-icon.${t}`:"image.badge-icon").forEach(r=>r.remove())}enableMoveOrder(){this.isMoveOrderEnabeld=!this.isMoveOrderEnabeld,this.isMoveOrderEnabeld||this.disableMoveOrder()}disableMoveOrder(){this.isMoveOrderEnabeld=!1,this.moveOrderModel={},this.clearAllBadgeIcons("selectico")}showOrdersList(){this.gto.openPosOrdersList$.next({apiFilters:{invoiceStatus:1},buttons:{Pick:1,Pay:1}})}handleClosePosOrdersList(t){"Pick"==t.action?this.common.navigateTo("../pos",{oId:t.inv.id}):"Pay"==t.action&&this.gto.openPosPaymentScreen$.next({forOrderId:t.inv.id})}handleClosePosPayment(t){this.invoiceHelperService.MakeOrderPayment(t),setTimeout(()=>{this.getTables(this.selectedFloor.id)},100)}fetchFloors(){}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(E.L),e.Y36(M.S),e.Y36(L.w),e.Y36(B.q),e.Y36(P.j),e.Y36(Z.i))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-tables-view"]],decls:28,vars:41,consts:[[1,"flex","justify-between","py-2","panel"],[1,"flex","gap-x-3"],["type","button","appShiftBlock","",1,"w-36","btn","btn-secondary",3,"click"],["type","button","appShiftBlock","",1,"w-36","btn",3,"ngClass","click"],[1,"flex","flex-wrap","justify-center","sm:justify-start","items-center","my-2"],["class","flex items-center ltr:mr-4 rtl:ml-4",4,"ngFor","ngForOf"],[1,"p-0","panel"],[3,"ngClass"],["id","svgBox",1,"col-span-11",2,"height","92vh",3,"ngClass"],["class","col-span-1","style","height: 92vh;",4,"ngIf"],["id","lockico",2,"display","none",3,"src"],["id","selectico",2,"display","none",3,"src"],[1,"flex","items-center","ltr:mr-4","rtl:ml-4"],[1,""],[1,"col-span-1",2,"height","92vh"],["class","floor-b",4,"ngFor","ngForOf"],[1,"floor-b"],["type","button",1,"btn",3,"ngClass","click"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"button",2),e.NdJ("click",function(){return s.showOrdersList()}),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"button",3),e.NdJ("click",function(){return s.enableMoveOrder()}),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"button",3),e.NdJ("click",function(){return s.enableMoveOrder()}),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"button",3),e.NdJ("click",function(){return s.enableMoveOrder()}),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"button",3),e.NdJ("click",function(){return s.enableMoveOrder()}),e._uU(15),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"div",4),e.YNc(18,N,5,6,"div",5),e.qZA()(),e.TgZ(19,"div",6)(20,"div",7),e._UZ(21,"div",8),e.YNc(22,D,2,1,"div",9),e.qZA()(),e._UZ(23,"img",10)(24,"img",11)(25,"app-pos-orders-list")(26,"app-move-order-items")(27,"app-pay-order-popup")),2&o&&(e.xp6(3),e.Oqu(e.lcZ(4,15,"OrdersList")),e.xp6(2),e.Q6J("ngClass",e.WLB(25,S,!s.isMoveOrderEnabeld,s.isMoveOrderEnabeld)),e.xp6(1),e.Oqu(e.lcZ(7,17,"MoveOrder")),e.xp6(2),e.Q6J("ngClass",e.WLB(28,S,!s.isMoveOrderEnabeld,s.isMoveOrderEnabeld)),e.xp6(1),e.Oqu(e.lcZ(10,19,"Pay")),e.xp6(2),e.Q6J("ngClass",e.WLB(31,S,!s.isMoveOrderEnabeld,s.isMoveOrderEnabeld)),e.xp6(1),e.Oqu(e.lcZ(13,21,"PartiallyPay")),e.xp6(2),e.Q6J("ngClass",e.WLB(34,S,!s.isMoveOrderEnabeld,s.isMoveOrderEnabeld)),e.xp6(1),e.Oqu(e.lcZ(16,23,"TableHistory")),e.xp6(3),e.Q6J("ngForOf",s.lstLkps.lstTablesStatus),e.xp6(2),e.Q6J("ngClass",e.VKq(37,Q,s.lstFloors.length>1)),e.xp6(1),e.Q6J("ngClass",e.VKq(39,_,s.lstFloors.length>1)),e.xp6(1),e.Q6J("ngIf",s.lstFloors.length>1),e.xp6(1),e.Q6J("src",s.comapnySetup.lockTableImg,e.LSH),e.xp6(1),e.Q6J("src",s.comapnySetup.selectTableImg,e.LSH))},dependencies:[T.mk,T.sg,T.O5,$.Z,q.e,J.$,V.V,I.X$],styles:[".floor-b[_ngcontent-%COMP%]{padding:0 10px 10px}.floor-b[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{width:100%;margin-bottom:5px;height:100px}"]})}return i})()}];let W=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#s=this.\u0275inj=e.cJS({imports:[F.Bz.forChild(H),F.Bz]})}return i})();var j=n(9126),G=n(332),K=n(8904),X=n(9798);let z=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#s=this.\u0275inj=e.cJS({providers:[L.w],imports:[T.ez,W,j.n,I.aw,G.B,K.l,X.m]})}return i})()}}]);