"use strict";(self.webpackChunkvristo_angular=self.webpackChunkvristo_angular||[]).push([[859],{3859:(L,C,r)=>{r.r(C),r.d(C,{AddInvoiceModule:()=>ue});var l=r(6895),_=r(3559),v=r(5861),e=r(4650),I=r(3407),c=r(4609),x=r(798),m=r(4641),p=r(8493),g=r(2477),h=r(9974);m.vfs=p.I.vfs;let O=(()=>{class i{constructor(t,o){this.common=t,this.general=o,this.pdfHeaderCallBack="",this.lstCols=[]}CreateReport(t){var o=this;return(0,v.Z)(function*(){o.pdfContent=[],o.data=t,o.printOrder(),o.general.printDoc(o.pdfContent)})()}printOrder(){this.pdfContent.push([this.patientIntoPart(),this.buildSplitter(),this.buildTablePart(this.data.lstItems),this.finalResult(this.data.lstItems),this.buildSplitter()])}patientIntoPart(){let t=new Date,n=[];return n.push([this.simpleHeaderRowInfoText("To Account:",this.data.accountName),{text:""},this.simpleHeaderRowInfoText("On Date:",this.common.dateTimeFormat(t))]),{layout:"noBorders",table:{widths:["*",150,"*"],body:n}}}buildSplitter(){return[{columns:[{width:"*",text:""},{width:"auto",canvas:[{type:"ellipse",x:15,y:5,color:"#70cae2",r1:5,r2:5},{type:"ellipse",x:30,y:5,color:"#70cae2",r1:5,r2:5},{type:"ellipse",x:45,y:5,color:"#70cae2",r1:5,r2:5},{type:"rect",x:60,y:0,w:300,h:10,r:5,color:"#70cae2"}]}],margin:[0,20,0,20]}]}simpleHeaderRowInfoText(t,o){let n=[!1,!1,!1,!1];return{layout:"noBorders",table:{margin:[0,0,0,0],headerRows:1,widths:[80,"*"],body:[[{text:this.general.arabicFormat(t),bold:!0,border:n},{text:this.general.arabicFormat(o),border:n,alignment:"left"}]]}}}buildTablePart(t){return this.lstCols=[{pdfWidth:20,prop:"i",title:""},{pdfWidth:150,prop:"itemName",title:"Item Name"},{pdfWidth:90,prop:"price",title:"Price"},{pdfWidth:"*",prop:"unitName",title:"Unit"},{pdfWidth:"*",prop:"quantity",title:"Quantity"},{pdfWidth:90,prop:"total",title:"Total",rule:["","Center"],alignment:"center"}],this.tableDesign(this.lstCols,t)}tableDesign(t,o){let n=[],s=[],a=[];return t.forEach(d=>{a.push({text:d.title??"",style:"tableHeader",alignment:d.alignment?d.alignment:"left"}),s.push(d.pdfWidth??"*")}),n.push(a),o.forEach((d,f)=>{let b=[];t.forEach(A=>{let Z=d[A.prop]??"";"i"==A.prop&&(Z=f+1+"");let y={text:Z,style:"tableCell"};A.rule&&(A.rule.indexOf("widgets")>-1&&(y=d[A.prop]),A.rule.indexOf("MinusToConst")>-1&&(y.text=Z<0?-1*Z:Z),A.rule.indexOf("Center")>-1&&(y.alignment="center")),b.push(y)}),n.push(b)}),[{table:{headerRows:1,widths:s,body:n},layout:{hLineWidth:function(d,f){return 0==d||1==d||d===f.table.body.length?0:1},vLineWidth:function(d){return 0},hLineColor:function(d){return 0!=d?"#00A9CE":""},paddingTop:function(d,f){return 5},paddingBottom:function(d,f){return 5},fillColor:function(d,f,b){return 0===d?"#00A9CE":null},textColor:function(d,f,b){return 0===d?"white":"black"}}}]}finalResult(t){let o=this.common.sum(t,"total");return{margin:[0,10,0,0],table:{layout:"noBorders",widths:this.lstCols.map(n=>n.pdfWidth),body:[[{text:""},{text:""},{text:""},{text:""},{text:"Final Total :",margin:[5,0,0,0],style:"tableCell"},{color:"",text:o,fontSize:14,bold:!0,alignment:"center"}]]},layout:"noBorders"}}static#e=this.\u0275fac=function(o){return new(o||i)(e.LFG(g.j),e.LFG(h.S))};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var U=r(2924),q=r(8060),D=r(8545),J=r(5344);const P=["template"];function R(i,u){if(1&i&&(e.O4$(),e.TgZ(0,"svg",1),e._UZ(1,"path",2)(2,"path",3),e.qZA()),2&i){const t=e.oxw();e.Q6J("ngClass",t.class)}}let E=(()=>{class i{constructor(t){this.viewContainerRef=t,this.class=""}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.template),this.viewContainerRef.element.nativeElement.remove()}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(e.s_b))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icon-send"]],viewQuery:function(o,n){if(1&o&&e.Gf(P,7),2&o){let s;e.iGM(s=e.CRH())&&(n.template=s.first)}},inputs:{class:"class"},decls:2,vars:0,consts:[["template",""],["width","20","height","20","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",3,"ngClass"],["d","M17.4975 18.4851L20.6281 9.09373C21.8764 5.34874 22.5006 3.47624 21.5122 2.48782C20.5237 1.49939 18.6511 2.12356 14.906 3.37189L5.57477 6.48218C3.49295 7.1761 2.45203 7.52305 2.13608 8.28637C2.06182 8.46577 2.01692 8.65596 2.00311 8.84963C1.94433 9.67365 2.72018 10.4495 4.27188 12.0011L4.55451 12.2837C4.80921 12.5384 4.93655 12.6658 5.03282 12.8075C5.22269 13.0871 5.33046 13.4143 5.34393 13.7519C5.35076 13.9232 5.32403 14.1013 5.27057 14.4574C5.07488 15.7612 4.97703 16.4131 5.0923 16.9147C5.32205 17.9146 6.09599 18.6995 7.09257 18.9433C7.59255 19.0656 8.24576 18.977 9.5522 18.7997L9.62363 18.79C9.99191 18.74 10.1761 18.715 10.3529 18.7257C10.6738 18.745 10.9838 18.8496 11.251 19.0285C11.3981 19.1271 11.5295 19.2585 11.7923 19.5213L12.0436 19.7725C13.5539 21.2828 14.309 22.0379 15.1101 21.9985C15.3309 21.9877 15.5479 21.9365 15.7503 21.8474C16.4844 21.5244 16.8221 20.5113 17.4975 18.4851Z","stroke","currentColor","stroke-width","1.5"],["opacity","0.5","d","M6 18L21 3","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"]],template:function(o,n){1&o&&e.YNc(0,R,3,1,"ng-template",null,0,e.W1O)},dependencies:[l.mk],encapsulation:2})}return i})();const F=["template"];function Q(i,u){if(1&i&&(e.O4$(),e.TgZ(0,"svg",1),e._UZ(1,"path",2)(2,"path",3)(3,"path",4),e.qZA()),2&i){const t=e.oxw();e.Q6J("ngClass",t.class)}}let N=(()=>{class i{constructor(t){this.viewContainerRef=t,this.class=""}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.template),this.viewContainerRef.element.nativeElement.remove()}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(e.s_b))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icon-trash"]],viewQuery:function(o,n){if(1&o&&e.Gf(F,7),2&o){let s;e.iGM(s=e.CRH())&&(n.template=s.first)}},inputs:{class:"class"},decls:2,vars:0,consts:[["template",""],["width","20","height","20","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",3,"ngClass"],["d","M20.5001 6H3.5","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"],["d","M18.8334 8.5L18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"],["opacity","0.5","d","M6.5 6C6.55588 6 6.58382 6 6.60915 5.99936C7.43259 5.97849 8.15902 5.45491 8.43922 4.68032C8.44784 4.65649 8.45667 4.62999 8.47434 4.57697L8.57143 4.28571C8.65431 4.03708 8.69575 3.91276 8.75071 3.8072C8.97001 3.38607 9.37574 3.09364 9.84461 3.01877C9.96213 3 10.0932 3 10.3553 3H13.6447C13.9068 3 14.0379 3 14.1554 3.01877C14.6243 3.09364 15.03 3.38607 15.2493 3.8072C15.3043 3.91276 15.3457 4.03708 15.4286 4.28571L15.5257 4.57697C15.5433 4.62992 15.5522 4.65651 15.5608 4.68032C15.841 5.45491 16.5674 5.97849 17.3909 5.99936C17.4162 6 17.4441 6 17.5 6","stroke","currentColor","stroke-width","1.5"]],template:function(o,n){1&o&&e.YNc(0,Q,4,1,"ng-template",null,0,e.W1O)},dependencies:[l.mk],encapsulation:2})}return i})();var S=r(5603),T=r(4006),M=r(1835),B=r(3222),w=r(4463);const k=function(i){return{lstItems:i}};function j(i,u){if(1&i&&(e.ynx(0),e.GkF(1,44),e.BQk()),2&i){const t=e.oxw(),o=e.MAs(154);e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,k,t.modal.lstItems))}}function Y(i,u){if(1&i&&(e.ynx(0),e.GkF(1,44),e.BQk()),2&i){const t=e.oxw(),o=e.MAs(154);e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,k,t.modal.lstItemsDeleted))}}function H(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"a",45),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.selectTabByVal(1))}),e._UZ(1,"icon-trash"),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.xp6(2),e.AsE(" ",e.lcZ(3,2,"DeletedItem")," (",t.modal.lstItemsDeleted.length,") ")}}function K(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"a",20),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.selectTabByVal(0))}),e._UZ(1,"icon-trash"),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&i&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"ItemsList")," "))}function V(i,u){if(1&i&&(e.TgZ(0,"span",47),e._uU(1),e.qZA()),2&i){const t=e.oxw().item;e.xp6(1),e.Oqu(t.variantName)}}function G(i,u){if(1&i&&(e.TgZ(0,"span",50),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.AsE("",t.addOnName," X ",t.qty,"")}}function W(i,u){if(1&i&&(e.ynx(0),e.YNc(1,G,2,2,"span",49),e.BQk()),2&i){const t=u.$implicit;e.xp6(1),e.Q6J("ngIf",t)}}function $(i,u){if(1&i&&(e.ynx(0),e.YNc(1,W,2,1,"ng-container",48),e.BQk()),2&i){const t=e.oxw().item;e.xp6(1),e.Q6J("ngForOf",t.lstAddOns)}}function X(i,u){if(1&i&&(e.YNc(0,V,2,1,"span",46),e.YNc(1,$,2,1,"ng-container",17)),2&i){const t=u.item;e.Q6J("ngIf",t.variantName),e.xp6(1),e.Q6J("ngIf",t.lstAddOns)}}function z(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"ng-select",66),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.unitId=n)})("ngModelChange",function(){e.CHM(t);const n=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.unitChanged(n))}),e.qZA()}if(2&i){const t=e.oxw().$implicit;e.Q6J("items",t.selectedItemObj.lstUnits)("ngModel",t.unitId)("clearable",!1)}}function ee(i,u){1&i&&(e.TgZ(0,"p"),e._uU(1," SelectItemFirst "),e.qZA())}const te=function(i){return{"bg-danger-light":i}},ne=function(i){return{item:i}};function oe(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"tr",57)(1,"td",58)(2,"ng-select",59),e.NdJ("ngModelChange",function(n){const a=e.CHM(t).$implicit;return e.KtG(a.itemId=n)})("ngModelChange",function(){const n=e.CHM(t),s=n.index,a=n.$implicit,d=e.oxw(2);return e.KtG(d.itemChanged(s,a))}),e.qZA(),e.TgZ(3,"div",60),e.GkF(4,44),e.qZA()(),e.TgZ(5,"td",58),e.YNc(6,z,1,3,"ng-select",61),e.YNc(7,ee,2,0,"p",17),e.qZA(),e.TgZ(8,"td",58)(9,"input",37),e.NdJ("ngModelChange",function(n){const a=e.CHM(t).$implicit;return e.KtG(a.price=n)})("ngModelChange",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.itemsListChanged())}),e.qZA()(),e.TgZ(10,"td",58)(11,"input",37),e.NdJ("ngModelChange",function(n){const a=e.CHM(t).$implicit;return e.KtG(a.quantity=n)})("ngModelChange",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.itemsListChanged())}),e.qZA()(),e.TgZ(12,"td",62)(13,"span",63),e._uU(14),e.qZA(),e.TgZ(15,"button",64),e.NdJ("click",function(){const s=e.CHM(t).index,a=e.oxw(2);return e.KtG(a.deleteRow("lstItems",s))}),e._UZ(16,"icon-trash-lines",65),e.qZA()()()}if(2&i){const t=u.$implicit,o=e.oxw(2),n=e.MAs(152);e.Q6J("ngClass",e.VKq(11,te,t.hasError)),e.xp6(2),e.Q6J("items",o.lstLkps.lstItemsLkp)("ngModel",t.itemId)("clearable",!1),e.xp6(2),e.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",e.VKq(13,ne,t)),e.xp6(2),e.Q6J("ngIf",t.selectedItemObj),e.xp6(1),e.Q6J("ngIf",!t.selectedItemObj),e.xp6(2),e.Q6J("ngModel",t.price),e.xp6(2),e.Q6J("ngModel",t.quantity),e.xp6(3),e.Oqu(t.total)}}function ie(i,u){if(1&i&&(e.TgZ(0,"div",51)(1,"table",52)(2,"thead",53)(3,"tr")(4,"th",54),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"th",55),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th",55),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th",55),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th",55),e._uU(17),e.ALo(18,"translate"),e.qZA()()(),e.TgZ(19,"tbody"),e.YNc(20,oe,17,15,"tr",56),e.qZA()()()),2&i){const t=u.lstItems;e.xp6(5),e.hij(" ",e.lcZ(6,6,"ItemName")," "),e.xp6(3),e.hij(" ",e.lcZ(9,8,"Unit")," "),e.xp6(3),e.hij(" ",e.lcZ(12,10,"Price")," "),e.xp6(3),e.hij(" ",e.lcZ(15,12,"Quantity")," "),e.xp6(3),e.hij(" ",e.lcZ(18,14,"Total")," "),e.xp6(3),e.Q6J("ngForOf",t)}}const se=function(i){return{"has-error":i}},le=[{path:"",component:(()=>{class i{constructor(t,o,n,s,a,d,f){this.lookupsService=t,this.gto=o,this.invoiceHelperService=n,this.invoiceReportPdf=s,this.managementService=a,this.common=d,this.route=f,this.lang="labelEn",this.modal={},this.lstData=[],this.lstLkpKeys=["_Account_","Branch","InvoiceCategories","lstInvoiceType","lstPaymentTypes","ItemsPricesLists","ItemUnits","Departments"],this.lstLkps={},this.lstKeysRequiredOnInventoryLookups=[],this.lstInventoryLookupsByKey={},this.reqFields=["accountId"],this.inputFailds={},this.lstWords={AreYouSure:"",DeleteThisItem:"","?":""},this.lastSelectedIndex=-1,this.tabs=[{label:"Items",value:0},{label:"DeletedItems",value:1}],this.selectedTab={},this.Id=this.route.snapshot.paramMap.get("id"),this.invCategory=this.common.getRouteParam(this.route,"invCategory","num"),this.selectTab(this.tabs[0]),this.common.translateList(this.lstWords),this.loadItems(),this.subscribeToEvents()}subscribeToEvents(){this.closePosSelectItemDetails=this.gto.closePosSelectItemDetails$.subscribe(t=>this.handleCloseSelectItem(t))}fetchRouteInvCategory(){this.invCategory&&this.lstLkps.InvoiceCategories&&(this.modal.invoiceCategoryId=this.invCategory,this.invoiceCategoryChanged())}ngOnInit(){this.loadLookups(),this.pageInit(),this.common.loadLkps(this.lstLkpKeys,this.lstLkps,this.handleLkps.bind(this))}handleLkps(){this.accountChanged(this.modal),this.fetchRouteInvCategory()}pageInit(){this.Id?this.GetDetails(this.Id):(this.modal={isActive:"true",lstItems:[{}],paymentType:0,discount:0},this.fetchRouteInvCategory())}GetDetails(t){this.managementService.InvoiceDetails({id:t}).subscribe(o=>{this.modal=this.parseObjFromServer(o),this.fetchSelectedItemsForInv()})}loadLookups(){this.lstKeysRequiredOnInventoryLookups.forEach(t=>{this.lookupsService.Lookups(t).subscribe(o=>{this.lstInventoryLookupsByKey[t]=o})})}parseObjFromServer(t){return t.lstDepartmentBranches&&(t._lstDepartmentBranches=t.lstDepartmentBranches.map(o=>o.branchId)),t.isActive=1==t.isActive?"true":"false",this.accountChanged(t),t}prepareObjToServer(t){return t.isActive="true"==t.isActive,t._lstDepartmentBranches&&(t.lstDepartmentBranches=t._lstDepartmentBranches.map(o=>({branchId:o}))),t}validateItems(){let t=["itemId","unitId","price","quantity"];return this.modal.lstItems.forEach(o=>{this.common.checkValidation(o,t).isValid?delete o.hasError:o.hasError=!0}),this.modal.lstItems.filter(o=>!o.hasError).length}print(){this.managementService.InvoiceReportQuery(this.Id).subscribe(t=>{this.invoiceReportPdf.CreateReport({...t})})}save(){let t=this.common.checkValidation(this.modal,this.reqFields),o=this.validateItems();if(t.isValid&&o!=this.modal.lstItems.length)this.common.error("Fill at least one valid item","");else if(t.isValid&&o>0){let n=this.prepareObjToServer(this.modal);this.managementService.AddInvoice(n).subscribe({next:s=>{this.inputFailds={},s.status&&(this.common.success("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638"),this.Id=s.entityId,this.GetDetails(this.Id)),s.lstError.length>0&&this.common.error("Error",s.lstError[0])},error:s=>{this.common.error("Fill required fields","")}})}else this.inputFailds=t.failerFields,this.common.error("Fill required fields","")}back(){this.common.navigateTo("../stock/invoices")}deleteRow(t,o){var n=this;return(0,v.Z)(function*(){n.modal[t][o].id?(yield n.common.confirmationMessage(n.lstWords.AreYouSure,`${n.lstWords.DeleteThisItem} ${n.lstWords["?"]}`)).value&&(n.executeDelete(t,o),n.itemsListChanged()):(n.executeDelete(t,o),n.itemsListChanged())})()}executeDelete(t,o){this.modal[t].splice(o,1)}newRow(t){this.modal[t]||(this.modal[t]=[]),this.modal[t].push({})}invoicePaidChange(){setTimeout(()=>{this.invoiceHelperService.updateInvoiceCalculateion(this.modal)},2)}itemsListChanged(t=this.modal){this.invoiceHelperService.refreshItemPrices(t),this.refreshInvoiceTotalQty(this.modal)}refreshInvoiceTotalQty(t){t&&t.lstItems&&(t.totQty=this.common.sum(t.lstItems,"quantity"))}selectItem(t,o){this.CheckItemTypeToAdd(t,o)}handleCloseSelectItem(t){t&&(this.DirectAddItemToCart(this.lastSelectedIndex,t),this.itemsListChanged())}CheckItemTypeToAdd(t,o){this.lastSelectedIndex=t,this.modal.lstItems||(this.modal.lstItems=[]),o.selectedItemObj.lstVariants&&0!=o.selectedItemObj.lstVariants.length?this.gto.openPosSelectItemDetails$.next(o.selectedItemObj):(this.DirectAddItemToCart(t,o.selectedItemObj??o),this.itemsListChanged())}DirectAddItemToCart(t,o){let n=this.mapItemToCart(o);n.lstAddOns||delete this.modal.lstItems[t].lstAddOns,this.modal.lstItems[t]={...this.modal.lstItems[t],...n}}mapItemToCart(t,o=1){console.log("mapItemToCart",t);let n={itemId:t.id,price:t.price,unitId:t.unitId??t.defaultUnitId,itemUnitId:t.itemUnitId,quantity:o};return n.name=t.name?t.name:"en"==this.common.currLang?t.nameEn:t.nameAr,t.variantId&&(n.variantId=t.variantId,n.variantName=t.variantName,n.variantPrice=t.variantPrice),t.lstAddOns&&(n.lstAddOns=t.lstAddOns),n.key=this.getItemKey(n),n}getItemKey(t){return`${t.itemId}_${t.variantId??""}_${t.lstAddOns?t.lstAddOns.sort((o,n)=>o.addOnId-n.addOnId).map(o=>`${o.addOnId}.${o.qty}`).join(","):""}`}itemChanged(t,o){setTimeout(()=>{let n=this.common.getRelatedFromLkp(this.lstLkps.lstItemsLkp,o.itemId,"id");o.selectedItemObj=n,this.selectItem(t,o)},1)}fetchSelectedItemsForInv(){this.modal.lstItems&&this.lstLkps.lstItemsLkp&&this.modal.lstItems.forEach(t=>t.selectedItemObj=this.common.getRelatedFromLkp(this.lstLkps.lstItemsLkp,t.itemId,"id"))}loadItems(){this.managementService.ItemListWithDetails({}).subscribe(t=>{this.common.fixImagesUrls(t.lstData,["img"]),t.lstData.forEach(o=>this.common.fixImagesUrls(o.lstVariants,["img"])),t.lstData.forEach(o=>this.common.fixImagesUrls(o.lstItemAddOns,["img"])),t.lstData.forEach(o=>o.label="en"==this.common.currLang?o.nameEn:o.nameAr),this.fixItemPrices(),this.lstLkps.lstItemsLkp=t.lstData,this.fetchSelectedItemsForInv()})}fixItemPrices(){this.lstLkps.lstItemsLkp&&this.modal&&this.modal.accDefaultPriceListFlag&&this.common.fixItemDefaultUnits(this.lstLkps.lstItemsLkp,this.modal.accDefaultPriceListFlag)}unitChanged(t){setTimeout(()=>{let o=this.common.getRelatedFromLkp(t.selectedItemObj.lstUnits,t.unitId,"unitId");o&&(t.price=Number(o[this.modal.accDefaultPriceListFlag]),this.itemsListChanged(this.modal))},1)}accountChanged(t,o=!1){setTimeout(()=>{if(t.accountId&&this.lstLkps._Account_&&this.lstLkps.ItemsPricesLists){let n=this.common.getRelatedFromLkp(this.lstLkps._Account_,t.accountId),s=this.common.getRelatedFromLkp(this.lstLkps.ItemsPricesLists,n.defaultPriceListId);t.accDefaultPriceListFlag=s.str1,o&&!t.accDefaultPriceListFlag&&alert("selected account not has a price list!"),this.fixItemPrices()}else 0==o&&delete t.accDefaultPriceListFlag},1)}changeInvoiceTotals(t){this.invoiceHelperService.calculateInvoiceTotals(this.modal,t)}invoiceCategoryChanged(){if(this.modal.invoiceCategoryId&&this.lstLkps.InvoiceCategories){let t=this.common.getRelatedFromLkp(this.lstLkps.InvoiceCategories,this.modal.invoiceCategoryId);t&&t.str1?this.modal.invoiceType=Number(t.str1):alert("Invoice Type not filled, Check InvoiceCategories into lookups and fill related type.")}}selectTab(t){this.selectedTab=t}selectTabByVal(t){this.selectTab(this.tabs.find(o=>o.value==t))}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(I.K),e.Y36(c.L),e.Y36(x.w),e.Y36(O),e.Y36(U.i),e.Y36(g.j),e.Y36(_.gz))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-add-invoice"]],decls:156,vars:112,consts:[[1,"space-y-2"],[1,"flex","justify-between","panel"],[1,"gap-2","cursor-pointer","btn","btn-secondary",3,"click"],[1,"flex","justify-end","text-black","dark:text-white","shrink-0"],["src","assets/images/logo.svg","alt","image",1,"w-10"],[1,"grid","grid-cols-8"],[1,"col-span-6","panel"],[1,"flex","justify-between","space-x-3"],[1,"space-y-2","w-full","lg:w-1/2"],[1,"flex","items-center",3,"ngClass"],[1,"w-1/4"],["bindLabel","label","bindValue","value",1,"w-3/4","form-control",3,"items","ngModel","clearable","ngModelChange"],[1,"flex","items-center"],["type","text",1,"w-3/4","form-input",3,"ngModel","ngModelChange"],["bindLabel","label","bindValue","value",1,"w-3/4","form-control",3,"items","ngModel","ngModelChange"],[1,"my-6","border-[#e0e6ed]","dark:border-[#1b2e4b]"],[1,"mt-8"],[4,"ngIf"],[1,"flex","sm:flex-row","flex-col","justify-between","mt-6","px-4"],[1,"mb-6","sm:mb-0"],[1,"flex","space-x-2","h-10","text-primary","cursor-pointer",3,"click"],["class","flex space-x-2 h-10 text-danger cursor-pointer",3,"click",4,"ngIf"],["class","flex space-x-2 h-10 text-primary cursor-pointer",3,"click",4,"ngIf"],[1,"sm:w-2/5"],[1,"flex","justify-between","items-center"],[1,"font-bold"],[1,"flex","justify-between","items-center","mt-4"],[1,"font-bold","text-primary"],[1,"mt-2","px-4"],[1,"min-h-[80px]","form-textarea",3,"ngModel","ngModelChange"],[1,"col-span-2","rtl:pr-2","ltr:pl-2"],[1,"mb-5","panel"],[1,"mt-4"],[1,"gap-4","grid","grid-cols-1","sm:grid-cols-2"],["type","number","placeholder","Amount",1,"form-input",3,"ngModel","ngModelChange"],["type","number","placeholder","%",1,"form-input",3,"ngModel","ngModelChange"],["bindLabel","label","bindValue","value",1,"form-control",3,"items","ngModel","ngModelChange"],["type","number",1,"form-input",3,"ngModel","ngModelChange"],[1,"panel"],[1,"gap-4","grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","xl:grid-cols-1"],["type","button",1,"gap-2","w-full","btn","btn-success",3,"click"],["type","button",1,"gap-2","w-full","btn","btn-secondary",3,"click"],["ItemExtraDetailsView",""],["ItemsList",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"flex","space-x-2","h-10","text-danger","cursor-pointer",3,"click"],["class","bg-primary m-0 badge",4,"ngIf"],[1,"bg-primary","m-0","badge"],[4,"ngFor","ngForOf"],["class","bg-info m-0 badge",4,"ngIf"],[1,"bg-info","m-0","badge"],[1,"table-responsive","sm-tbl"],[1,"w-full","text-gray-500","dark:text-gray-400","text-sm","text-left","rtl:text-right"],[1,"text-gray-700","dark:text-gray-400","text-xs","uppercase"],[1,"bg-gray-50","dark:bg-gray-800","lg-col"],[1,"sm-col"],["class","border-gray-200 dark:border-gray-700 border-b",3,"ngClass",4,"ngFor","ngForOf"],[1,"border-gray-200","dark:border-gray-700","border-b",3,"ngClass"],[1,"px-1","py-1"],["bindLabel","label","bindValue","id",3,"items","ngModel","clearable","ngModelChange"],[1,"mt-1","extraDetail"],["bindLabel","unitName","bindValue","unitId",3,"items","ngModel","clearable","ngModelChange",4,"ngIf"],[1,"flex","justify-between","items-center","px-1","py-1","min-h-16"],[1,"font-bold","text-blue-900"],["type","button",1,"ml-auto","hover:text-danger",3,"click"],[1,"w-4.5","h-4.5"],["bindLabel","unitName","bindValue","unitId",3,"items","ngModel","clearable","ngModelChange"]],template:function(o,n){if(1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"a",2),e.NdJ("click",function(){return n.back()}),e._UZ(4,"icon-arrow-backward"),e._uU(5),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"div")(8,"div",3),e._UZ(9,"img",4),e.qZA()()(),e.TgZ(10,"div",5)(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"label",10),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"ng-select",11),e.NdJ("ngModelChange",function(){return n.accountChanged(n.modal,!0)})("ngModelChange",function(a){return n.modal.accountId=a}),e.qZA()(),e.TgZ(19,"div",12)(20,"label",10),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"input",13),e.NdJ("ngModelChange",function(a){return n.modal.code=a}),e.qZA()()(),e.TgZ(24,"div",8)(25,"div",12)(26,"label",10),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"ng-select",14),e.NdJ("ngModelChange",function(a){return n.modal.branchId=a}),e.qZA()(),e.TgZ(30,"div",12)(31,"label",10),e._uU(32),e.ALo(33,"translate"),e.qZA(),e.TgZ(34,"ng-select",14),e.NdJ("ngModelChange",function(a){return n.modal.branchId=a}),e.qZA()()()(),e._UZ(35,"hr",15),e.TgZ(36,"div",16),e.YNc(37,j,2,4,"ng-container",17),e.YNc(38,Y,2,4,"ng-container",17),e.TgZ(39,"div",18)(40,"div",19)(41,"a",20),e.NdJ("click",function(){return n.newRow("lstItems")}),e._UZ(42,"icon-plus"),e._uU(43),e.ALo(44,"translate"),e.qZA(),e.YNc(45,H,4,4,"a",21),e.YNc(46,K,4,3,"a",22),e.qZA(),e._UZ(47,"div",19),e.TgZ(48,"div",23)(49,"div",24)(50,"div"),e._uU(51),e.ALo(52,"translate"),e.qZA(),e.TgZ(53,"div",25),e._uU(54),e.ALo(55,"number"),e.qZA()(),e.TgZ(56,"div",26)(57,"div"),e._uU(58),e.ALo(59,"translate"),e.TgZ(60,"span",25),e._uU(61),e.ALo(62,"number"),e.qZA(),e._uU(63,")"),e.qZA(),e.TgZ(64,"div",25),e._uU(65),e.ALo(66,"number"),e.qZA()(),e.TgZ(67,"div",26)(68,"div"),e._uU(69),e.ALo(70,"translate"),e.TgZ(71,"span",25),e._uU(72),e.ALo(73,"number"),e.qZA(),e._uU(74,")"),e.qZA(),e.TgZ(75,"div",25),e._uU(76),e.ALo(77,"number"),e.qZA()(),e.TgZ(78,"div",26)(79,"div"),e._uU(80),e.ALo(81,"translate"),e.qZA(),e.TgZ(82,"div",25),e._uU(83),e.ALo(84,"number"),e.qZA()(),e.TgZ(85,"div",26)(86,"div"),e._uU(87),e.ALo(88,"translate"),e.qZA(),e.TgZ(89,"div",27),e._uU(90),e.ALo(91,"number"),e.qZA()(),e.TgZ(92,"div",26)(93,"div"),e._uU(94),e.ALo(95,"translate"),e.qZA()()()()(),e.TgZ(96,"div",28)(97,"div")(98,"label"),e._uU(99),e.ALo(100,"translate"),e.qZA(),e.TgZ(101,"textarea",29),e.NdJ("ngModelChange",function(a){return n.modal.notes=a}),e.qZA()()()(),e.TgZ(102,"div",30)(103,"div",31)(104,"div")(105,"label"),e._uU(106),e.ALo(107,"translate"),e.qZA()(),e.TgZ(108,"div",32)(109,"div",33)(110,"div")(111,"label"),e._uU(112),e.ALo(113,"translate"),e.qZA(),e.TgZ(114,"input",34),e.NdJ("ngModelChange",function(a){return n.modal.discAmount=a})("ngModelChange",function(){return n.changeInvoiceTotals("discAmount")}),e.qZA()(),e.TgZ(115,"div")(116,"label"),e._uU(117),e.ALo(118,"translate"),e.qZA(),e.TgZ(119,"input",35),e.NdJ("ngModelChange",function(a){return n.modal.discPer=a})("ngModelChange",function(){return n.changeInvoiceTotals("discPer")}),e.qZA()()(),e.TgZ(120,"div",33)(121,"div")(122,"label"),e._uU(123),e.ALo(124,"translate"),e.qZA(),e.TgZ(125,"input",34),e.NdJ("ngModelChange",function(a){return n.modal.serAmount=a})("ngModelChange",function(){return n.changeInvoiceTotals("serAmount")}),e.qZA()(),e.TgZ(126,"div")(127,"label"),e._uU(128),e.ALo(129,"translate"),e.qZA(),e.TgZ(130,"input",35),e.NdJ("ngModelChange",function(a){return n.modal.serPer=a})("ngModelChange",function(){return n.changeInvoiceTotals("serPer")}),e.qZA()()()(),e.TgZ(131,"div",32)(132,"label"),e._uU(133),e.ALo(134,"translate"),e.qZA(),e.TgZ(135,"ng-select",36),e.NdJ("ngModelChange",function(a){return n.modal.paymentType=a}),e.qZA()(),e.TgZ(136,"div",32)(137,"label"),e._uU(138),e.ALo(139,"translate"),e.qZA(),e.TgZ(140,"input",37),e.NdJ("ngModelChange",function(){return n.invoicePaidChange()})("ngModelChange",function(a){return n.modal.paid=a}),e.qZA()()(),e.TgZ(141,"div",38)(142,"div",39)(143,"button",40),e.NdJ("click",function(){return n.save()}),e._UZ(144,"icon-save"),e._uU(145),e.ALo(146,"translate"),e.qZA(),e.TgZ(147,"button",41),e.NdJ("click",function(){return n.print()}),e._UZ(148,"icon-send"),e._uU(149),e.ALo(150,"translate"),e.qZA()()()()()(),e.YNc(151,X,2,2,"ng-template",null,42,e.W1O),e.YNc(153,ie,21,16,"ng-template",null,43,e.W1O),e._UZ(155,"app-select-item-variant-add-on")),2&o){let s,a;e.xp6(5),e.hij(" ",e.lcZ(6,52,"Back")," "),e.xp6(9),e.Q6J("ngClass",e.VKq(110,se,n.inputFailds.accountId)),e.xp6(2),e.Oqu(e.lcZ(17,54,"Account")),e.xp6(2),e.Q6J("items",n.lstLkps._Account_)("ngModel",n.modal.accountId)("clearable",!1),e.xp6(3),e.Oqu(e.lcZ(22,56,"Referance")),e.xp6(2),e.Q6J("ngModel",n.modal.code),e.xp6(4),e.Oqu(e.lcZ(28,58,"Branch")),e.xp6(2),e.Q6J("items",n.lstLkps.Branch)("ngModel",n.modal.branchId),e.xp6(3),e.Oqu(e.lcZ(33,60,"Department")),e.xp6(2),e.Q6J("items",n.lstLkps.Departments)("ngModel",n.modal.branchId),e.xp6(3),e.Q6J("ngIf",0==n.selectedTab.value),e.xp6(1),e.Q6J("ngIf",1==n.selectedTab.value),e.xp6(5),e.hij(" ",e.lcZ(44,62,"Add")," "),e.xp6(2),e.Q6J("ngIf",n.modal.lstItemsDeleted&&n.modal.lstItemsDeleted.length>0&&0==n.selectedTab.value),e.xp6(1),e.Q6J("ngIf",1==n.selectedTab.value),e.xp6(5),e.Oqu(e.lcZ(52,64,"Total")),e.xp6(3),e.Oqu(e.lcZ(55,66,n.modal.totalBeforeDiscount)),e.xp6(4),e.hij("",e.lcZ(59,68,"Discount")," ("),e.xp6(3),e.AsE("",e.lcZ(62,70,null!==(s=n.modal.discPer)&&void 0!==s?s:0),"",n.modal.discPer?"%":"",""),e.xp6(4),e.Oqu(e.lcZ(66,72,n.modal.discAmount)),e.xp6(4),e.hij("",e.lcZ(70,74,"Service")," ("),e.xp6(3),e.AsE("",e.lcZ(73,76,null!==(a=n.modal.serPer)&&void 0!==a?a:0),"",n.modal.serPer?"%":"",""),e.xp6(4),e.Oqu(e.lcZ(77,78,n.modal.serAmount)),e.xp6(4),e.Oqu(e.lcZ(81,80,"FinalTotal")),e.xp6(3),e.Oqu(e.lcZ(84,82,n.modal.finalTotal)),e.xp6(4),e.Oqu(e.lcZ(88,84,"Paid")),e.xp6(3),e.Oqu(e.lcZ(91,86,n.modal.paid)),e.xp6(4),e.Oqu(e.lcZ(95,88,"Remaining")),e.xp6(5),e.Oqu(e.lcZ(100,90,"Notes")),e.xp6(2),e.Q6J("ngModel",n.modal.notes),e.xp6(5),e.Oqu(e.lcZ(107,92,"Other")),e.xp6(6),e.hij("",e.lcZ(113,94,"Discount"),"(F) "),e.xp6(2),e.Q6J("ngModel",n.modal.discAmount),e.xp6(3),e.hij("",e.lcZ(118,96,"Discount"),"(%) "),e.xp6(2),e.Q6J("ngModel",n.modal.discPer),e.xp6(4),e.hij("",e.lcZ(124,98,"Service"),"(F) "),e.xp6(2),e.Q6J("ngModel",n.modal.serAmount),e.xp6(3),e.hij("",e.lcZ(129,100,"Service"),"(%) "),e.xp6(2),e.Q6J("ngModel",n.modal.serPer),e.xp6(3),e.Oqu(e.lcZ(134,102,"PaymentMethod")),e.xp6(2),e.Q6J("items",n.lstLkps.lstPaymentTypes)("ngModel",n.modal.paymentType),e.xp6(3),e.Oqu(e.lcZ(139,104,"Paid")),e.xp6(2),e.Q6J("ngModel",n.modal.paid),e.xp6(5),e.hij(" ",e.lcZ(146,106,"Save")," "),e.xp6(4),e.hij(" ",e.lcZ(150,108,"Print")," ")}},dependencies:[l.mk,l.sg,l.O5,l.tP,q.J,D.E,J.s,E,N,S.p,T.Fj,T.wV,T.JJ,T.On,M.w9,B._,l.JJ,w.X$]})}return i})()}];let ae=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[_.Bz.forChild(le),_.Bz]})}return i})();var re=r(9886),ce=r(4180),de=r(4868),me=r(9116),pe=r(7679);let ue=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({providers:[x.w],imports:[l.ez,ae,me.Q,T.u5,de.tA,T.UX,w.aw,ce.$9,M.A0,re.zk,pe.b]})}return i})()},8060:(L,C,r)=>{r.d(C,{J:()=>I});var l=r(4650),_=r(6895);const v=["template"];function e(c,x){if(1&c&&(l.O4$(),l.TgZ(0,"svg",1),l._UZ(1,"path",2)(2,"path",3),l.qZA()),2&c){const m=l.oxw();l.Q6J("ngClass",m.class)}}let I=(()=>{class c{constructor(m){this.viewContainerRef=m,this.class=""}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.template),this.viewContainerRef.element.nativeElement.remove()}static#e=this.\u0275fac=function(p){return new(p||c)(l.Y36(l.s_b))};static#t=this.\u0275cmp=l.Xpm({type:c,selectors:[["icon-arrow-backward"]],viewQuery:function(p,g){if(1&p&&l.Gf(v,7),2&p){let h;l.iGM(h=l.CRH())&&(g.template=h.first)}},inputs:{class:"class"},decls:2,vars:0,consts:[["template",""],["width","20","height","20","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",3,"ngClass"],["d","M9.5 7L4.5 12L9.5 17","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["opacity","0.5","d","M4.5 12L14.5 12C16.1667 12 19.5 13 19.5 17","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"]],template:function(p,g){1&p&&l.YNc(0,e,3,1,"ng-template",null,0,l.W1O)},dependencies:[_.mk],encapsulation:2})}return c})()},8545:(L,C,r)=>{r.d(C,{E:()=>I});var l=r(4650),_=r(6895);const v=["template"];function e(c,x){if(1&c&&(l.O4$(),l.TgZ(0,"svg",1),l._UZ(1,"line",2)(2,"line",3),l.qZA()),2&c){const m=l.oxw();l.Q6J("ngClass",m.class)}}let I=(()=>{class c{constructor(m){this.viewContainerRef=m,this.class=""}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.template),this.viewContainerRef.element.nativeElement.remove()}static#e=this.\u0275fac=function(p){return new(p||c)(l.Y36(l.s_b))};static#t=this.\u0275cmp=l.Xpm({type:c,selectors:[["icon-plus"]],viewQuery:function(p,g){if(1&p&&l.Gf(v,7),2&p){let h;l.iGM(h=l.CRH())&&(g.template=h.first)}},inputs:{class:"class"},decls:2,vars:0,consts:[["template",""],["width","20","height","20","viewBox","0 0 24 24","stroke","currentColor","stroke-width","1.5","fill","none","stroke-linecap","round","stroke-linejoin","round",3,"ngClass"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"]],template:function(p,g){1&p&&l.YNc(0,e,3,1,"ng-template",null,0,l.W1O)},dependencies:[_.mk],encapsulation:2})}return c})()},5344:(L,C,r)=>{r.d(C,{s:()=>I});var l=r(4650),_=r(6895);const v=["template"];function e(c,x){if(1&c&&(l.O4$(),l.TgZ(0,"svg",1),l._UZ(1,"path",2)(2,"path",3)(3,"path",4),l.qZA()),2&c){const m=l.oxw();l.Q6J("ngClass",m.class)}}let I=(()=>{class c{constructor(m){this.viewContainerRef=m,this.class=""}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.template),this.viewContainerRef.element.nativeElement.remove()}static#e=this.\u0275fac=function(p){return new(p||c)(l.Y36(l.s_b))};static#t=this.\u0275cmp=l.Xpm({type:c,selectors:[["icon-save"]],viewQuery:function(p,g){if(1&p&&l.Gf(v,7),2&p){let h;l.iGM(h=l.CRH())&&(g.template=h.first)}},inputs:{class:"class"},decls:2,vars:0,consts:[["template",""],["width","20","height","20","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",3,"ngClass"],["d","M3.46447 20.5355C4.92893 22 7.28595 22 12 22C16.714 22 19.0711 22 20.5355 20.5355C22 19.0711 22 16.714 22 12C22 11.6585 22 11.4878 21.9848 11.3142C21.9142 10.5049 21.586 9.71257 21.0637 9.09034C20.9516 8.95687 20.828 8.83317 20.5806 8.58578L15.4142 3.41944C15.1668 3.17206 15.0431 3.04835 14.9097 2.93631C14.2874 2.414 13.4951 2.08581 12.6858 2.01515C12.5122 2 12.3415 2 12 2C7.28595 2 4.92893 2 3.46447 3.46447C2 4.92893 2 7.28595 2 12C2 16.714 2 19.0711 3.46447 20.5355Z","stroke","currentColor","stroke-width","1.5"],["d","M17 22V21C17 19.1144 17 18.1716 16.4142 17.5858C15.8284 17 14.8856 17 13 17H11C9.11438 17 8.17157 17 7.58579 17.5858C7 18.1716 7 19.1144 7 21V22","stroke","currentColor","stroke-width","1.5"],["opacity","0.5","d","M7 8H13","stroke","currentColor","stroke-width","1.5","stroke-linecap","round"]],template:function(p,g){1&p&&l.YNc(0,e,4,1,"ng-template",null,0,l.W1O)},dependencies:[_.mk],encapsulation:2})}return c})()}}]);